<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Career on Autopilot</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #4A90E2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #357ABD; }
        .response { margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; white-space: pre-wrap; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ API Test - Career on Autopilot</h1>
    
    <div class="test-section">
        <h3>1. –¢–µ—Å—Ç AI —á–∞—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        <input type="text" id="employee-query" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –¥–ª—è AI (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–∫ —Å—Ç–∞—Ç—å senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º?)" value="–ö–∞–∫ —Å—Ç–∞—Ç—å senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º?">
        <button onclick="testEmployeeChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
        <div id="employee-response" class="response"></div>
    </div>

    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç AI —á–∞—Ç–∞ HR</h3>
        <input type="text" id="hr-query" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤" value="–ù–∞–π–¥–∏ senior Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞">
        <button onclick="testHrChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
        <div id="hr-response" class="response"></div>
    </div>

    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        <input type="number" id="employee-id" placeholder="ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞" value="123">
        <button onclick="testGetEmployee()">–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <div id="employee-data" class="response"></div>
    </div>

    <div class="test-section">
        <h3>4. –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
        <textarea id="search-criteria" placeholder='–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ' rows="3">{"hard_skills": ["Python"], "level": "senior"}</textarea>
        <button onclick="testSearchEmployees()">–ü–æ–∏—Å–∫</button>
        <div id="search-results" class="response"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π markdown
        function displayResponse(responseDiv, status, data) {
            let responseText = `–°—Ç–∞—Ç—É—Å: ${status}\n–û—Ç–≤–µ—Ç: ${JSON.stringify(data, null, 2)}`;
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å markdown –≤ –æ—Ç–≤–µ—Ç–µ, –ø–æ–ø—Ä–æ–±—É–µ–º –µ–≥–æ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å
            if (data.response && typeof marked !== 'undefined') {
                const markdownPreview = `\n\n--- Markdown Preview ---\n${marked.parse(data.response)}`;
                responseText += markdownPreview;
            }
            
            responseDiv.innerHTML = responseText.replace(/\n/g, '<br>');
        }

        async function testEmployeeChat() {
            const query = document.getElementById('employee-query').value;
            const responseDiv = document.getElementById('employee-response');
            
            try {
                responseDiv.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        role: 'employee',
                        userId: 123
                    })
                });
                
                const data = await response.json();
                displayResponse(responseDiv, response.status, data);
            } catch (error) {
                responseDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testHrChat() {
            const query = document.getElementById('hr-query').value;
            const responseDiv = document.getElementById('hr-response');
            
            try {
                responseDiv.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        role: 'manager'
                    })
                });
                
                const data = await response.json();
                displayResponse(responseDiv, response.status, data);
            } catch (error) {
                responseDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testGetEmployee() {
            const employeeId = document.getElementById('employee-id').value;
            const responseDiv = document.getElementById('employee-data');
            
            try {
                responseDiv.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
                const response = await fetch(`${API_BASE}/api/employee/${employeeId}`);
                const data = await response.json();
                displayResponse(responseDiv, response.status, data);
            } catch (error) {
                responseDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testSearchEmployees() {
            const criteria = document.getElementById('search-criteria').value;
            const responseDiv = document.getElementById('search-results');
            
            try {
                responseDiv.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
                const response = await fetch(`${API_BASE}/api/employees/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        criteria: JSON.parse(criteria)
                    })
                });
                
                const data = await response.json();
                displayResponse(responseDiv, response.status, data);
            } catch (error) {
                responseDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
    </script>
</body>
</html>
